<?php

if (!isset($CFG->block_vmoodle_automatedshema)){
    set_config('block_vmoodle_automatedshema', 1);
}
if (!isset($CFG->block_vmoodle_vdbtype)){
    set_config('block_vmoodle_vdbtype', 'mysql');
}
if (!isset($CFG->block_vmoodle_vdbpersist)){
    set_config('block_vmoodle_vdbpersist', 0);
}
if (!isset($CFG->block_vmoodle_mnet)){
    set_config('block_vmoodle_mnet', 0);
}
if (!isset($CFG->block_vmoodle_mnet_openall)){
    set_config('block_vmoodle_mnet_openall', 1);
}
?>
<div style="text-align:center;">
<table cellspacing="5">
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('automatedschema', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <?php 
                $opts[0] = get_string('no');
                $opts[1] = get_string('yes');
                choose_from_menu($opts, 'block_vmoodle_automatedschema', $CFG->block_vmoodle_automatedshema);
             ?>
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('vmoodlehost', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <input id="block_vmoodle_vmoodlehost" type="text" name="block_vmoodle_vmoodlehost" value="<?php 
            if(isset($CFG->block_vmoodle_vmoodlehost)) {
                p($CFG->block_vmoodle_vmoodlehost);
            } else {
                p(preg_replace('/(https?:\/\/)([^.]+)/', '$1<%%INSTANCE%%>', $CFG->wwwroot));
            } ?>"/><br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('vmoodleip', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <input id="block_vmoodle_vmoodleip" type="text" name="block_vmoodle_vmoodleip" value="<?php 
            if(isset($CFG->block_vmoodle_vmoodleip)) {
                p($CFG->block_vmoodle_vmoodleip);
            } else {
                p("127.0.0.1");
            } ?>"/><br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dbtype', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <?php
             $opts['mysql'] = "MySQL";
             $opts['postgres'] = "Postgres";
             choose_from_menu($opts, 'block_vmoodle_vdbtype', $CFG->block_vmoodle_vdbtype);
            ?>
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dbhost', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <input id="block_vmoodle_vdbhost" type="text" name="block_vmoodle_vdbhost" value="<?php 
            if(isset($CFG->block_vmoodle_vdbhost)) {
                p($CFG->block_vmoodle_vdbhost);
            } else {
                p('localhost');
            } ?>"/><br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dblogin', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <input id="block_vmoodle_vdblogin" type="text" name="block_vmoodle_vdblogin" value="<?php 
            if(isset($CFG->block_vmoodle_vdblogin)) {
                p($CFG->block_vmoodle_vdblogin);
            } else {
                p('root');
            } ?>"/><br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dbpass', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <input id="block_vmoodle_vdbpass" type="text" name="block_vmoodle_vdbpass" value="<?php 
            if(isset($CFG->block_vmoodle_vdbpass)) {
                p($CFG->block_vmoodle_vdbpass);
            } else {
                p('');
            } ?>"/><br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dbbasename', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <input id="block_vmoodle_vdbbasename" type="text" name="block_vmoodle_vdbbasename" value="<?php 
            if(isset($CFG->block_vmoodle_vdbbasename)) {
                p($CFG->block_vmoodle_vdbbasename);
            } else {
                p('vmoodle_');
            } ?>"/><br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dbprefix', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <input id="block_vmoodle_vdbprefix" type="text" name="block_vmoodle_vdbprefix" value="<?php 
            if(isset($CFG->block_vmoodle_vdbprefix)) {
                p($CFG->block_vmoodle_vdbprefix);
            } else {
                p('mdl_');
            } ?>"/><br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dbpersist', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <?php
             $persistopts[0] = get_string('no');
             $persistopts[1] = get_string('yes');
             choose_from_menu($persistopts, 'block_vmoodle_vdbpersist', $CFG->block_vmoodle_vdbpersist);
            ?>
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('datapathbase', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <input id="block_vmoodle_vdatapathbase" type="text" name="block_vmoodle_vdatapathbase" value="<?php 
            if(isset($CFG->block_vmoodle_vdatapathbase)) {
                p(stripslashes($CFG->block_vmoodle_vdatapathbase));
            } else {
                p('/Data/Moodle_secured/vmoodle_');
            } ?>"/><br/>
        </td>
    </tr>
</table>
<fieldset>
<legend><?php print_string('mnet', 'block_vmoodle') ?></legend>
<table cellspacing="5">
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('mnetenabled', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <?php
             $opts[0] = get_string('no');
             $opts[1] = get_string('yes');
             choose_from_menu($opts, 'block_vmoodle_mnet', $CFG->block_vmoodle_mnet);
            ?>
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('mnetopenservices', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <?php
             unset($opts);
             $opts[0] = get_string('donotopenservices', 'block_vmoodle');
             $opts[1] = get_string('openallservices', 'block_vmoodle');
             choose_from_menu($opts, 'block_vmoodle_mnet_openall', $CFG->block_vmoodle_mnet_openall);
            ?>
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('organization', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <input id="block_vmoodle_organization" type="text" name="block_vmoodle_organization" value="<?php 
            if(isset($CFG->block_vmoodle_organization)) {
                p($CFG->block_vmoodle_organization);
            } else {
                p(get_string('organization', 'block_vmoodle'));
            } ?>"/><br/>
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('organizationunit', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <input id="block_vmoodle_organization_unit" type="text" name="block_vmoodle_organization_unit" value="<?php 
            if(isset($CFG->block_vmoodle_organization_unit)) {
                p($CFG->block_vmoodle_organization_unit);
            } else {
                p(get_string('organizationunit', 'block_vmoodle'));
            } ?>"/><br/>
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('organizationmail', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <input id="block_vmoodle_organization_email" type="text" name="block_vmoodle_organization_email" value="<?php 
            if(isset($CFG->block_vmoodle_organization_email)) {
                p($CFG->block_vmoodle_organization_email);
            } else {
                p(get_string('organizationmail', 'block_vmoodle'));
            } ?>"/><br/>
            <br/>
        </td>
    </tr>
</table>
</fieldset>

<fieldset>
<legend><?php print_string('tools', 'block_vmoodle') ?></legend>
<table width="100%">
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('mysqlcmd', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <input id="block_vmoodle_cmd_mysql" type="text" name="block_vmoodle_cmd_mysql" value="<?php 
            if(isset($CFG->block_vmoodle_cmd_mysql)) {
                p(stripslashes($CFG->block_vmoodle_cmd_mysql));
            } else {
                echo 'mysql';
            } ?>"/><br/>
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('mysqldumpcmd', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <input id="block_vmoodle_cmd_mysqldump" type="text" name="block_vmoodle_cmd_mysqldump" value="<?php 
            if(isset($CFG->block_vmoodle_cmd_mysqldump)) {
                p(stripslashes($CFG->block_vmoodle_cmd_mysqldump));
            } else {
                echo 'mysqldump';
            } ?>"/><br/>
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('pgsqlcmd', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <input id="block_vmoodle_cmd_pgsql" type="text" name="block_vmoodle_cmd_pgsql" value="<?php 
            if(isset($CFG->block_vmoodle_cmd_pgsql)) {
                p(stripslashes($CFG->block_vmoodle_cmd_pgsql));
            } else {
                echo '';
            } ?>"/><br/>
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('pgsqldumpcmd', 'block_vmoodle') ?>:</b>
        </td>
        <td valign="top" align="left">
            <input id="block_vmoodle_cmd_pgsqldump" type="text" name="block_vmoodle_cmd_pgsqldump" value="<?php 
            if(isset($CFG->block_vmoodle_cmd_pgsqldump)) {
                p(stripslashes($CFG->block_vmoodle_cmd_pgsqldump));
            } else {
                echo '';
            } ?>"/><br/>
            <br/>
        </td>
    </tr>
</table>
</fieldset>

<fieldset>
<legend><?php print_string('key_autorenew_parms', 'block_vmoodle') ?></legend>
<?php
if (!isset($CFG->mnet_key_autorenew)) $CFG->mnet_key_autorenew = 0;
if (!isset($CFG->mnet_key_autorenew_gap)) $CFG->mnet_key_autorenew_gap = 24 * 3;
if (!isset($CFG->mnet_key_autorenew_time)) $CFG->mnet_key_autorenew_time = 0;
?>
<table width="100%">
    <tr>
        <td class="generalboxcontent">
            <table cellpadding="9" cellspacing="0" >
                <tr valign="top">
                    <td align="right"><?php print_string('mnet_key_autorenew', 'block_vmoodle'); ?>:</td>
                    <td>
                        <input type="radio" name="mnet_key_autorenew" value="0" <?php echo (!$CFG->mnet_key_autorenew)? 'checked="checked"' : '' ?> /> <?php print_string('off', 'block_vmoodle'); ?>
                        &nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" name="mnet_key_autorenew" value="1" <?php echo ($CFG->mnet_key_autorenew)? 'checked="checked"' : '' ?> /> <?php print_string('on', 'block_vmoodle'); ?><br />
                    </td>
                </tr>
                <tr valign="middle">
                    <td align="right"><?php print_string('mnet_key_autorenew_gap', 'block_vmoodle'); ?>:</td>
                    <td>
                        <input type="text" name="mnet_key_autorenew_gap" value="<?php echo $CFG->mnet_key_autorenew_gap ?>" size="4" />
                        <?php print_string('hours'); ?>
                    </td>
                </tr>
                <tr valign="top">
                    <td align="right"><?php print_string('mnet_key_autorenew_time', 'block_vmoodle'); ?>:</td>
                    <td>
                        <?php print_time_selector('mnet_key_autorenew_hour', 'mnet_key_autorenew_min', $CFG->mnet_key_autorenew_time) ?>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</fieldset>

<table cellspacing="5">
    <tr>
        <td valign="top" align="right" colspan="2">
            <input type="submit" value="<?php print_string('savechanges'); ?>" />
        </td>
    </tr>
</table>
</div>
